

== Installing the LSDTopoTools python toolchain

So you have tried looking at *LSDTopoTools* output and are prepared to try our fancy python scripts. I am afraid before you can use these you are going to have to install our python toolchain. 

The most painless way to do this is with http://conda.pydata.org/miniconda.html[miniconda] and our environment files. 

WARNING: Even if the python installation works flawlessly and installs first time, it will still take some time and suck up quite a lot of space on your hard drive.

=== Where do I install the *LSDTopoTools* python toolchain

If you are working in native linux then you don't have to worry about this. But if you are using either a Docker or Vagrant setup, you will: do you install on your host operating system or on the Linux system that lives as a container or virtual machine?

We have installed the toolchain on our host operating system. There are three main reasons we did this:

* The container/virtual machine systems have no windowing so you can't use spyder. We like to use spyder so we wanted a windowing system. 
* I (SMM) tried to install the toolchain once on our vagrant machine and it killed GDAL. I don't understand why this happened but GDAL is absolutely essential to LSDTopoTools data preparation so I had to destroy my vagrant box and start again from scratch. So I've only got this working on my Windows system (but others have got it working on Linux and MacOS).
* Chances are you might want to use python for something other than LSDTopoTools and it is convineint to have pyhton installed on your host machine. 

If you really want to install the toolchain in your vagrant/docker box go ahead but it will be difficult for us to debug since we have not done this ourselves. 


=== Setting up Python the easy way

This is a quick guide. There are many options for setting up python but this is our preferred setup. 

. Download and install http://conda.pydata.org/miniconda.html[miniconda] on your host machine. 
. Open a command prompt (use the start menu to search for *cmd.exe*)
. Get our  https://raw.githubusercontent.com/LSDtopotools/LSDMappingTools/a1e4bd94911afc25a10ed2482553736bc2ce8894/environment.yml[environment file].
. Create the environment from that file with:
+
[source,console]
----
> conda env create -f environment.yml
----
+
I'm afraid this will take a little while. 
. Activate the environment:
+
[source,console]
----
> activate LSDTT
----

NOTE: This environment does not include *spyder*, you can install it with `conda install -n LSDTT spyder`

=== Setting up python the hard way (without the `environment.yml` file)

NOTE: This is an alternative to the previous section!

. The best way to install python is http://conda.pydata.org/miniconda.html[miniconda]. Currently everything we use is tested on **Python 2.7**, so use the Python 2.7 installer. However, we have attempted to maintain compatibility to python 3.x. If you use that, it should be okay, but please report any bugs on the github page.  
+
WARNING: Our visualisation routines involve some computation, and dealing with geospatial data. This means that there are a number of packages to install. This might take some time. If you are already using python for something critical you may consider setting up a https://realpython.com/blog/python/python-virtual-environments-a-primer/[virtual] http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/[environment] to ensure all of these new packages don't break what you've already got. 
+
. Once you have installed  http://conda.pydata.org/miniconda.html[miniconda], you can go into a command prompt (windows) or terminal (MacOS and Linux) and get the other stuff you need. To get the command prompt in windows look for the *cmd.exe* program.
+
. You should create a python environment for *LSDTopoTools*. Read about https://conda.io/docs/user-guide/tasks/manage-environments.html[conda python environments here]:
+
[source,console]
----
> conda config --add channels conda-forge
> conda create --name LSDTT
> conda install -n LSDTT shapely
> conda install -n LSDTT fiona
> conda install -n LSDTT rasterio
> conda install -n LSDTT scipy
> conda install -n LSDTT matplotlib
> conda install -n LSDTT pandas
> conda install -n LSDTT gdal
> conda install -n LSDTT pyproj
> conda install -n LSDTT descartes
> conda install -n LSDTT spyder
> conda activate LSDTT
----
+
. Every time you use our tools, you should activate the *LSDTT* python environment. 
+
. To run spyder you just type `spyder` at the command line. 
+
WARNING: Spyder needs an older version of a package called *PyQt*. If spyder doesn't start correctly, run `conda install pyqt=4.10 -f`  
+
NOTE: It is entirely possible that we have forgotten some package, but if you run one of our scripts and it tells you the package is not found, just use `conda` to install.

=== Using Spyder

Once you have installed python, you can use it from the command line (i.e. from a powershell or terminal window). However, you might prefer using a nice development environment that checks your code and has pretty colours and reassuring windows. When we are not using text editors (see our section <<Text editors for modifying files>>) we tend to use Spyder, which has an editor that can give you help with python packages and highlight your mistakes. You should have already installed it with `conda install spyder`, so to get it running go into a powershell or terminal window and just type:

[source,console]
----
> spyder
----

IMPORTANT: You cannot run spyder on the vagrant machine since it has no windowing system. If you want to run *Spyder* you need to use your host operating system. This is the one of the reasons we encourage you to do your python installation on your host operating system and not the vagrant machine. 

== Getting our *LSDMappingTools* and other tools

Our vagrant setup has no graphic interface (you only interact with it through a terminal) so we suggest using your host operating system for python. 

. You need to clone our repository https://github.com/LSDtopotools/LSDMappingTools[LSDMappingTools]. 
+
WARNING: At the moment https://github.com/LSDtopotools/LSDMappingTools[LSDMappingTools] is a complete mess. It currently serves as a bit of a sandbox for visualisation development. One day we will clean it all up and make a nice, pretty release. But for now I'm afraid you'll need to rely on this repository. 
+
. If you don't want to install https://git-scm.com/[git] on your host operating system, you can clone the repository from your vagrant machine. Because of the clever way vagrant works you will be able to use these files in you host operating system.
+
[source,console]
----
$ cd /LSDTopoTools/Git_projects
$ git clone https://github.com/LSDtopotools/LSDMappingTools.git
----
+
NOTE: In your host operating system these files will not be in `/LSDTopoTools/Git_projects`. They will be within the `VagrantBoxes\LSDTopoTools\Git_projects` directory (wherever you put it. On windows I put mine in the `C` directory). 
+
. Once you have this repository you can move on to our examples in the next chapter.

=== Fixing python gdal in windows

If you are using windows, there is a stupid bug in the *conda* gdal package where it cannot find the gdal data. To fix this:

. Search for the file *gcs.csv*. Note the folder in which it is located. On my system it is in `C:\Miniconda2\Library\share\gdal`
. Go into the control panel, go to system (or system and security, then system), click on *advanced system settings* and in system variables enter a new variable: *GDAL_DATA*. For the value of this enter the directory where the gdal data is that you fond above.  

